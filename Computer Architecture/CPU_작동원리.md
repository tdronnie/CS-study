# CPU_작동원리
## CPU, MPU, MCU차이
세가지 모두 다 CPU와 연관이 있는 것 같다. 하지만 비슷하고도 완전히 다른 점이 있다.

CPU(Central Processor Unit)는 중앙처리장치로 하나의 프로세서이다.

MPU(Micro Processor Unit)는 CPU의 한 종류이지만 기계어 해석과 연산기능만 할 수 있는 프로세서이다. 이름에서도 알 수 있듯이 CPU를 소형화 시킨 것이라고 볼 수 있다. MCU와 비슷한 구성요소를 가지지만 작동을 위해 추가적인 주변 장치가 필요하다.

MCU(Micro Controller Unit)는 CPU의 기능을 하는 핵심장치와 주변장치가 포함된 통합형 칩셋으로 볼 수 있다.

컴퓨터를 소형화 시킨것이라고 할 수 있고 예전엔 MICOM(MIcro-COMputer)라고 불렸다.
차량용 ECU과 같이 기능이 많이 필요없는 작은 전자제품에 사용된다. 일반 컴퓨터는 메인보드에 여러가지 장치가 연결되고 칩도 여러개 있다면 MCU는 하나의 칩에 집적회로로 되어 있다. 따라서 소형화가 가능하고 그에 따라 제조비용절감을 기대할 수 있다!

---

## CPU 구성

CPU는 연산장치(ALU), 제어장치, 레지스터로 구성된다.

### 연산장치(ALU, Arithmetic and Logical Unit) : 산술과 논리 연산을 수행
    
**레지스터 ->(데이터)-> 연산장치<br>**
**연산장치 ->(연산결과)-> 레지스터**


### 제어장치 : 명령어를 순서대로 실행할 수 있도록 제어<br>
    
**메인메모리 ->(프로그램 명령어)-> 제어장치<br>**
    프로그램 명령어를 받은 후 해독한다.<br>

**제어장치 <-(신호)-> 연산장치<br>**
**제어장치 <-(신호)-> 기억장치<br>**
**제어장치 <-(신호)-> 입출력장치<br>**
해독결과에 따른 명령어 실행을 위한 제어신호를 보내고 장치들이 보낸 신호를 잗아 다음에 수행할 동직을 결정한다.


### 레지스터

고속 기억장치로 명령어 주소, 코드, 연산에 필요한 데이터와 연산결과를 임시 저장한다.

CPU 종류에 따라 레지스터 개수와 크기가 다르다.

레지스터는 범용 레지스터와 특수목적 레지스터로 나뉜다.

  - **범용 레지스터** : CPU가 데이터를 처리하는 과정에서 일반적으로 사용되는 레지스터
    
    - DR(Data Register)/누산기(ACC,Accumulator) : 산술연산, 논리연산에 사용되고 결과값을 저장
    - 주소 레지스터(AR, Address Register) : 메모리 주소 계산에 사용
    - 범용 레지스터(GPR, General Purpose Register) : 다양한 목적으로 사용
  

  - **특수목적 레지스터** : 특별한 용도로 사용되는 레지스터, 특별한 것을 저장
    
    - 프로그램 카운터(PC, Program Counter) : 다음에 수행할 명령어 주소 저장 -> 프로그램 실행 순서 제어하기 위함
    - 명령어 레지스터(IR, Instruction register) : 현재 실행중인 명령어 저장 -> 명령어 해독과 실행에 필요한 정보 제공
    - 누산기(ACC) : 산술 연산 결과 저장
    - 메모리 버퍼 레지스터(MBR) : 메인메모리에서 읽어온 데이터나 쓰려는 데이터 임시저장
      
        레지스터에 배치된 명령은 IR로, 데이터 내용은 ACC또는 IO레지스터로 전송
    - 누산기 : 연산 결과 임시저장 -> 계산된 값을 다음 명령어에 전달하는데 사용
    - 이외에 베이스 포인터, 스택 포인터, 상태 레지스터 등이 있다.


### cf. 범용 레지스터의 주소 레지스터(AR), 특수목적 레지스터의 메모리 주소 레지스터(MAR), 메모리 버퍼 레지스터(MBR)

AR은 메모리 주소를 계산하기 위해 사용된다. CPU에서 명령어를 수행할 때 피연산자나 메모리 주소를 저장하기 위해 사용된다. 다른 범용 레지스터와 동일한 방식으로 작동된다.


MAR에는 CPU가 메모리에서 데이터를 읽거나 쓸 데이터의 메모리 주소가 저장된다. 저장된 주솟값으로 메모리와 CPU가 데이터를 주고받는다. 데이터 버스를 통해서 메모리 주소 선으로 전송된다.

AR과 MAR은 모두 메모리 접근을 위해 사용되는 레지스터인데 범용이나 특수목적이냐의 차이를 가진다.

MBR은 MAR과 다르게 메모리와 CPU가 데이터를 주고받을 때 메모리 자체를 저장하는 레지스터이다. 따라서 MAR과 MBR은 같이 쓰인다.
MAR에 저장한 메모리 주소에서 데이터 가져와서 MBR에 저장, 데이터 처리 후 MBR에 저장된 데이터들을 MAR이 저장한 주소로 전송된다.


---

## CPU 동작과정

메인메모리는 입력장치에서 입력받은 데이터나 하드디스크에 저장된 프로그램을 읽어온다.

CPU는 프로그램을 실행하기 위해 메인메모리에 저장된 프로그램 명령어와 데이터를 읽어와 처리한 후 결과를 메인메모리에 다시 저장한다.

메인메모리는 처리결과를 하드디스크에 저장하거나 출력장치로 보낸다.

CPU의 제어장치는 이전의 과정에서 명령어가 순서대로 원활하게 실행되도록 장치들을 제어한다.

### CPU가 실행하는 명령어 구성

명령어는 연산 코드와 피연산자로 이루어짐

> 연산 코드(Operation Code)는 실행할 연산(연산, 제어, 데이터 전달, 입출력 기능 등)
> 
>피연산자(operand)는 데이터나 저장위치

CPU가 메인메모리에서 한번에 하나의 명령어를 인출해서 실행하는 것을 명령어 사이클이라고 한다.

### 명령어 사이클

인출 -> 실행 -> 간접 -> 인터럽트

인출 : 메인메모리의 지정된 주소에서 명령어 가져오기

실행 : 명령어 실행

명령어 실행이 완료되면 다음 명령어의 인출 사이클 시작

**인출 사이클 상세**

1. PC(Program Counter)에 저장된 주소를 MAR로 전달
2. 저장된 내용을 토대로 메인메모리의 해당 주소에서 명령어 인출
3. 인출한 명령어를 MBR에 저장한다.
4. 다음 실행될 명령어를 가리키기 위해 PC를 증가시킨다. 증가값은 명령어의 길이에 따라 다르다.
5. MBR의 데이터를 IR에 전달한다.

인출 사이클은 CPU가 다음 실행할 명령어를 가져오는 단계이다. 직접적으로 메모리를 읽어오는 작업을 하므로 인출 사이클 속도는 전체 CPU성능에 영향을 미친다.

```
T0 : MAR <- PC
T1 : MBR <- M[MAR], PC <- PC + 1 # M[MAR]은 MAR에 저장된 주소에 따른 명령어?
T2 : IR <- MBR
```

**실행 사이클 상세**

ADD addr 명령어 실행했을 때
```
T0 : MAR <- IR(Addr)
T1 : MBR <- M[MAR]
T2 : ACC <- ACC + MBR
```

이미 인출된 이후 실행만 하면된다.
IR에 MBR값이 저장되어 있으므로 ACC에 MBR을 더해주기만 하면 된다.


### 참고

https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Computer%20Architecture/%EC%A4%91%EC%95%99%EC%B2%98%EB%A6%AC%EC%9E%A5%EC%B9%98(CPU)%20%EC%9E%91%EB%8F%99%20%EC%9B%90%EB%A6%AC.md